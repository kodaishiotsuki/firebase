<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="utf-8" />
    <title>ä¼šå“¡ç™»éŒ²ã‚¢ãƒ—ãƒª</title>
    <link rel="stylesheet" href="./css/style.css" />
  </head>
  <body>
    <!-- ã‚³ãƒ³ãƒ†ãƒ³ãƒ„è¡¨ç¤ºå†…å®¹ -->
    <div class="container">
      <h1>Membership management</h1>
      <label class="name">Name</label>
      <input type="text" id="namebox" /><br /><br />
      <label class="rollno">RollNo</label>
      <input type="number" id="rollbox" /><br /><br />
      <label class="type">Type </label
      ><input type="text" id="secbox" /><br /><br />
      <label>Gender</label>
      <select id="genbox">
        <option value="Male">Male</option>
        <option value="Female">Female</option>
      </select>
      <hr />
      <button id="insbtn">INSERT</button>
      <button id="selbtn">SELECT</button>
      <button id="updbtn">UPDATE</button>
      <button id="delbtn">DELETE</button>
    </div>
    <!-- ã‚³ãƒ³ãƒ†ãƒ³ãƒ„è¡¨ç¤ºå†…å®¹ -->

    <!-- JQuery -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <!-- JQuery -->

    <!--** ä»¥ä¸‹Firebase **-->
    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/9.2.0/firebase-app.js";
      //33ã€œ41è¡Œç›®ã¾ã§ã¯è¿½åŠ ã§è¨˜å…¥ï¼ï¼
      import {
        //importå†…ã¯ä½¿ç”¨ã™ã‚‹é–¢æ•°ã‚’å®šç¾©
        getFirestore,
        collection,
        doc,
        addDoc,
        getDoc,
        setDoc,
        updateDoc,
        deleteDoc,
        deleteField,
        serverTimestamp,
        query,
        orderBy,
        onSnapshot,
        Timestamp,
      } from "https://www.gstatic.com/firebasejs/9.2.0/firebase-firestore.js"; //importã«å®šç¾©ã—ãŸã®ã‚’firestoreã§ä½¿ç”¨

      const firebaseConfig = {
        //apikeyã¯æ¶ˆã™ï¼
        apiKey: "",
        authDomain: "work-d7939.firebaseapp.com",
        projectId: "work-d7939",
        storageBucket: "work-d7939.appspot.com",
        messagingSenderId: "819553065695",
        appId: "1:819553065695:web:82cdcaaa9282b498a1676a",
      };
      const app = initializeApp(firebaseConfig);
      const db = getFirestore(app); //firestoreã‚’ä½¿ã†ã‚ˆ

      ///////////////////////////ç·´ç¿’////////////////////////////////////
      // const ref = collection(db, "chat"); //ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³â€™chatâ€™ã‚’ä½¿ã†ã‚ˆ

      // //é€ä¿¡å‡¦ç†
      // $("#send").on("click", function () {
      //   //ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆé–¢æ•°ã‚’å®šç¾©
      //   const ob = {
      //     //inputã‚¿ã‚°,id=nameã‚’å–å¾—
      //     name: $("#name").val(),
      //     //inputã‚¿ã‚°,id=textã‚’å–å¾—
      //     text: $("#text").val(),
      //     //dateã‚’å–å¾—
      //     date: Timestamp.now(),
      //   };
      //   //addDoc(ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³æŒ‡å®š,ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆå¤‰æ•°);ã§ãƒ‡ãƒ¼ã‚¿é€ä¿¡
      //   const docRef = addDoc(ref, ob);
      // });

      // /////////////////////ãƒ‡ãƒ¼ã‚¿å—ä¿¡//////////////////////////////
      // //70ã€œ81ã¯å†™çµŒ!!!ä¸­èº«ã ã‘å¤‰æ›´ã™ã‚‹ã‚¤ãƒ¡ãƒ¼ã‚¸
      // const q = query(ref, orderBy("date", "desc"));
      // onSnapshot(q, function (snapshot) {
      //   snapshot.docChanges().forEach((change) => {
      //     let h = "<p>";
      //     h += change.doc.data().name;
      //     h += "<br>";
      //     h += change.doc.data().text;
      //     h += "</p>";
      //     //hã‚’ä¸€ç•ªä¸‹ã«è¿½åŠ ã™ã‚‹
      //     $("#output").append(h);
      //   });
      // });

      //ãƒ†ã‚­ã‚¹ãƒˆãƒ»ãƒœã‚¿ãƒ³å®šæ•°ã‚’å®šç¾©////////////////////////////////

      let namebox = document.getElementById("namebox");
      let rollbox = document.getElementById("rollbox");
      let secbox = document.getElementById("secbox");
      let genbox = document.getElementById("genbox");

      let insbtn = document.getElementById("insbtn");
      let selbtn = document.getElementById("selbtn");
      let updbtn = document.getElementById("updbtn");
      let delbtn = document.getElementById("delbtn");

      ////////////////////INSERTã‚»ã‚¯ã‚·ãƒ§ãƒ³/////////////////////////
      // async function AddDocument_AutoID() {
      //   let ref = collection(db, "MenberList");
      //   const docRef = await addDoc(ref, {
      //     //inputã‚¿ã‚°,id=nameboxã‚’å–å¾—
      //     NameOfStd: $("#namebox").val(),
      //     //inputã‚¿ã‚°,id=rollboxã‚’å–å¾—
      //     RollNo: $("#rollbox").val(),
      //     //inputã‚¿ã‚°,id=secboxã‚’å–å¾—
      //     Section: $("#secbox").val(),
      //     //inputã‚¿ã‚°,id=genboxã‚’å–å¾—
      //     Gender: $("#genbox").val(),
      //   });
      //   try {
      //     alert("data added successfully!!");
      //   } catch (error) {
      //     alert("Unsuccessful operation error");
      //   }
      // }
      //
      //
      //ãƒ‡ãƒ¼ã‚¿å–å¾—ã®æ¡ä»¶æŒ‡å®š
      //firestoreã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã€ŒMenberListã€ã‚’å®šç¾©
      const ob = addDoc(collection(db, "MenberList"), {
        //inputã‚¿ã‚°,id=nameboxã‚’å–å¾—
        NameOfStd: $("#namebox").val(),
        //inputã‚¿ã‚°,id=rollboxã‚’å–å¾—
        RollNo: $("#rollbox").val(),
        //inputã‚¿ã‚°,id=secboxã‚’å–å¾—
        Section: $("#secbox").val(),
        //inputã‚¿ã‚°,id=genboxã‚’å–å¾—
        Gender: $("#genbox").val(),
      });

      ////////////////////////SETã‚»ã‚¯ã‚·ãƒ§ãƒ³////////////////////////
      // async function AddDocument_CustomID() {
      //   let ref = doc(db, "MenberList", rollbox.value);
      //   await setDoc(ref, {
      //     //inputã‚¿ã‚°,id=nameboxã‚’å–å¾—
      //     NameOfStd: $("#namebox").val(),
      //     //inputã‚¿ã‚°,id=rollboxã‚’å–å¾—
      //     RollNo: $("#rollbox").val(),
      //     //inputã‚¿ã‚°,id=secboxã‚’å–å¾—
      //     Section: $("#secbox").val(),
      //     //inputã‚¿ã‚°,id=genboxã‚’å–å¾—
      //     Gender: $("#genbox").val(),
      //   });
      //   try {
      //     alert("data added successfully!!");
      //   } catch (error) {
      //     alert("Unsuccessful operation error");
      //   }
      // };
      // insbtn.addEventListener("click", AddDocument_CustomID);

      //INSERTãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã¨ã‚¤ãƒ™ãƒ³ãƒˆç™ºç”Ÿ
      $("#insbtn").on("click", function () {
        const ob = {
          //inputã‚¿ã‚°,id=nameboxã‚’å–å¾—
          NameOfStd: $("#namebox").val(),
          //inputã‚¿ã‚°,id=rollboxã‚’å–å¾—
          RollNo: $("#rollbox").val(),
          //inputã‚¿ã‚°,id=secboxã‚’å–å¾—
          Section: $("#secbox").val(),
          //inputã‚¿ã‚°,id=genboxã‚’å–å¾—
          Gender: $("#genbox").val(),
        };
        //ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã€ŒMenberListã€å†…ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã€ŒRollNoã€ã‚’ã‚»ãƒƒãƒˆï¼ˆå›ºå®šï¼Ÿï¼‰
        setDoc(doc(db, "MenberList", rollbox.value), ob);
        try {
          //ã‚»ãƒƒãƒˆæˆåŠŸã—ãŸã‚‰ã‚¢ãƒ©ãƒ¼ãƒˆç™ºç”Ÿ
          alert("data added successfully!!");
        } catch (error) {
          //ã‚»ãƒƒãƒˆå¤±æ•—ã—ãŸã‚‰ã‚¢ãƒ©ãƒ¼ãƒˆç™ºç”Ÿ
          alert("Unsuccessful operation error");
        }
      });
      /////////////////////SELECTã‚»ã‚¯ã‚·ãƒ§ãƒ³////////////////////////

      // $("#selbtn").on("click", function (e) {
      //   const docsnap = getDoc(doc(db, "MenberList", rollbox.value));
      //   // â†‘ä½•å›ã‚‚æ›¸ã„ã¦è¦šãˆã‚‹
      //   if (docsnap !== null) {
      //     //firestoreã«rollboxã®æ•°å­—ãŒå­˜åœ¨ã™ã‚‹ã¨ã
      //     //nameboxã«firestoreã®NameOfStdã‚’è¡¨ç¤º
      //     $("#namebox").val(docsnap.data().NameOfStd);
      //     //nameboxã«firestoreã®Sectionã‚’è¡¨ç¤º
      //     $("#secbox").val(docsnap.data().Section);
      //     //nameboxã«firestoreã®Genderã‚’è¡¨ç¤º
      //     $("#genbox").val(docsnap.data().Gender);
      //   } else {
      //     //ãªã„æ™‚â†’ã‚¢ãƒ©ãƒ¼ãƒˆç™ºç”Ÿ
      //     alert("No such Document....");
      //   }
      // });

      // selãƒœã‚¿ãƒ³ã‚’æŠ¼ã™â†’RollNoã‹ã‚‰firestoreä¸Šã®ãƒ‡ãƒ¼ã‚¿ã‚’å‡ºåŠ›
      async function GetDocument() {
        //firestoreå†…ã®RollNoã‚’å–å¾—
        const docsnap = await getDoc(doc(db, "MenberList", rollbox.value));
        //â†‘ä½•å›ã‚‚æ›¸ã„ã¦è¦šãˆã‚‹
        if (docsnap.exists()) {
          //firestoreã«rollboxã®æ•°å­—ãŒå­˜åœ¨ã™ã‚‹ã¨ã
          //nameboxã«firestoreã®NameOfStdã‚’è¡¨ç¤º
          $("#namebox").val(docsnap.data().NameOfStd);
          //nameboxã«firestoreã®Sectionã‚’è¡¨ç¤º
          $("#secbox").val(docsnap.data().Section);
          //nameboxã«firestoreã®Genderã‚’è¡¨ç¤º
          $("#genbox").val(docsnap.data().Gender);
        } else {
          //ãªã„æ™‚â†’ã‚¢ãƒ©ãƒ¼ãƒˆç™ºç”Ÿ
          alert("No such Document....");
        }
      }
      //ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ã‚¤ãƒ™ãƒ³ãƒˆç™ºç”Ÿ
      selbtn.addEventListener("click", GetDocument);
      //â€»on('click',function){}ã§ã¯å‹•ã‹ãªã‹ã£ãŸã€‚ã€‚ã€‚ã€‚ã€‚ã€‚
      /////////////////////////////////////////////

      ///////////////////////UPDATE////////////////
      //updbtnã‚’æŠ¼ã™â†’ã‚¤ãƒ™ãƒ³ãƒˆç™ºç”Ÿ
      $("#updbtn").on("click", function () {
        const ob = {
          //inputã‚¿ã‚°,id=nameboxã‚’å–å¾—
          NameOfStd: $("#namebox").val(),
          //inputã‚¿ã‚°,id=secboxã‚’å–å¾—
          Section: $("#secbox").val(),
          //inputã‚¿ã‚°,id=genboxã‚’å–å¾—
          Gender: $("#genbox").val(),
        };
        updateDoc(doc(db, "MenberList", rollbox.value), ob);
        //â†‘ä½•å›ã‚‚æ›¸ã„ã¦è¦šãˆã‚‹
        try {
          //ã‚¢ãƒ—ãƒ‡â†’ã‚¢ãƒ©ãƒ¼ãƒˆç™ºç”Ÿ
          alert("data updated successfully!!");
        } catch (error) {
          //ã‚¨ãƒ©ãƒ¼ã‚¢ãƒ©ãƒ¼ãƒˆç™ºç”Ÿ
          alert("Unsuccessful operation error");
        }
      });

      // async function UpdateFieldsInADocument() {
      //   let ref = doc(db, "MenberList", rollbox.value);
      //   await updateDoc(ref, {
      //     //inputã‚¿ã‚°,id=nameboxã‚’å–å¾—
      //     NameOfStd: $("#namebox").val(),
      //     //inputã‚¿ã‚°,id=secboxã‚’å–å¾—
      //     Section: $("#secbox").val(),
      //     //inputã‚¿ã‚°,id=genboxã‚’å–å¾—
      //     Gender: $("#genbox").val(),
      //   });
      //   try {
      //     alert("data updated successfully!!");
      //   } catch (error) {
      //     alert("Unsuccessful operation error");
      //   }
      // }
      // updbtn.addEventListener("click", UpdateFieldsInADocument);
      ////////////////////////////////////////////////////////////

      /////////////////////DELETEã‚»ã‚¯ã‚·ãƒ§ãƒ³////////////////////////
      //delãƒœã‚¿ãƒ³ã‚’æŠ¼ã™â†’RollNoã‹ã‚‰firestoreä¸Šã®ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤
      async function DeleteDocument() {
        let ref = doc(db, "MenberList", rollbox.value);
        const docsnap = await getDoc(ref);
        if (!docsnap.exists()) {
          alert("document does not existğŸ˜¢");
          return;
        }

        await deleteDoc(ref);
        try {
          alert("data deleted successfully!!");
        } catch (error) {
          alert("Unsuccessful operation error");
        }
      }
      delbtn.addEventListener("click", DeleteDocument);
      /////////////////////////////////////////////////////////////
    </script>
    <script src="./js/main.js"></script>
  </body>
</html>
